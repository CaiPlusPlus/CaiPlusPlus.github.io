---
title: "Golang学习总结"
date: 2024-02-24T14:22:36+08:00
lastmod: 2024-05-01T10:00:00+08:00
draft: false
description: "Golang开发技巧与陷阱总结"
categories: ["编程语言"]
tags: ["Golang", "后端开发"]
featured_image: "/images/golang.jpg"
---

# Golang学习总结

## GOPATH设置的意义
- 简单理解就是Go的工作路径
- 管理Go代码库，使用go build、install、get、mod等命令

## 基础语法

### 循环（go range）
这是一个语法糖，底层是for循环，初始化会拷贝遍历的列表，然后每次遍历都是对同一个临时变量的遍历赋值。

**坑1**：对临时变量取地址，最终的值就是最后一个值的

**解决**：
- 使用局部变量拷贝这个临时变量再取地址
- 直接索引获取原来的元素再取地址

**坑2**：初始化时会拷贝原列表，对原列表追加数据不会引发异常

**坑3**：对大数组遍历会初始化拷贝引发内存浪费

**解决**：
- 数组取地址遍历&arr
- 数组切片引用arr[:]

**坑4**：map删除没有遍历到的数据是没异常的；map新增元素是有可能遍历到的（测试小值较大概率没遍历到）

**解决**：map和slice数据指向底层数据结构，没有拷贝

**坑5**：在使用goroutine中直接使用循环中的临时变量，导致全部都是最后一个变量

**解决**：
- 调用goroutine时使用参数传入，值传递
- 使用局部变量拷贝传递

### 指针
直接申明指针或者new()来创建指针变量

### 结构体-方法
继承主要使用组合方式

### 接口
- 接口作为函数参数->提供给实现该接口的系列结构体
- 使用new()生成结构体实例，可显性指定接口
- 接口嵌套

### defer
延迟的函数是在函数return和发生panic的时候被调用

函数的return并非一个原子操作，return的过程可以被分解为以下三步：
1. 设置返回值
2. 执行defer语句
3. 将结果返回

**延迟调用的语法规则**：
- defer关键字后面表达式必须是函数或者方法调用
- 延迟内容不能被括号括起来
- 配合recover处理panic

### 并发
- goroutine: recover只能捕获一次panic，并且只能捕获当前goroutine的
- channel: 是并发安全的
- sync: 锁复制后的新的锁拥有了原来的锁状态
- map非并发安全，sync.map是

**mutex和atomic区别**：
- 使用方式：通常mutex用于保护一段执行逻辑，而atomic主要是对变量进行操作
- 底层实现：mutex由操作系统调度器实现，而atomic操作有底层硬件指令支持，保证在CPU上执行不中断。所以atomic的性能也能随CPU的个数增加线性提升

### 协程池
主要就是worker, task, pool

## 进阶主题

### 内存管理
待补充...

### 错误处理最佳实践
待补充... 